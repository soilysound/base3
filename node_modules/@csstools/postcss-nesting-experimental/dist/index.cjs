"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var t=e(require("postcss-selector-parser"));function n(e){if(!e.nodes.length)return void e.remove();const t=e.nodes.filter((e=>"comment"===e.type));t.length===e.nodes.length&&e.replaceWith(...t)}function o(e,t){const o=t.index(e);if(o){const e=t.cloneBefore().removeAll().append(t.nodes.slice(0,o));e.raws.semicolon=!0,n(e)}t.before(e),t.raws.semicolon=!0}function r(e,r,s){o(e,r),e.selectors=function(e,n,o,r){const s=[];if(0===r.length)return;const c=t.default().astSync(`:is(${o.join(",")})`);for(let o=0;o<r.length;o++){const l=t.default().astSync(r[o]);if(!l)continue;let i=!1;if(l.walk((e=>{"nesting"===e.type&&(i=!0)})),!i){const s=l.nodes[0];let c=!1;if(s.each((e=>"combinator"===e.type&&(c=!0,!1))),0===o){let t=!1;s.each((e=>"tag"===e.type&&(t=!0,!1))),t&&e.warn(n,`Invalid nested rule : "${r[o]}"`)}c||s.insertBefore(s.at(0),t.default.combinator({value:" "})),s.insertBefore(s.at(0),t.default.nesting({}))}l.walk((e=>{"nesting"===e.type&&e.replaceWith(c.clone({}))})),s.push(l.toString())}return s}(e,s,r.selectors,e.selectors);"rule"===e.type&&"rule"===r.type&&e.selector===r.selector&&e.append(...r.nodes),n(r)}var s=["container","document","media","supports","layer"];function c(e){const t=[];let n="",o=!1,r=0,s=!1,c=!1;for(const l of e)c?c=!1:"\\"===l?c=!0:s?l===s&&(s=!1):'"'===l||"'"===l?s=l:"("===l?r+=1:")"===l?r>0&&(r-=1):0===r&&","===l&&(o=!0),o?(""!==n&&t.push(n.trim()),n="",o=!1):n+=l;return t.push(n.trim()),t}function l(e,t){var r,s;o(e,t),e.params=(r=t.params,s=e.params,c(r).map((e=>c(s).map((t=>`${e} and ${t}`)).join(", "))).join(", ")),n(t)}function i(e){return e&&"atrule"===e.type}function a(e){return e&&"rule"===e.type}function u(e,t){e.each((e=>{const c=e.parent;a(e)&&e.selector.trim()&&a(c)&&c.selector.trim()?r(e,c,t):i(e)&&a(c)&&c.selector.trim()&&function(e){return s.includes(e.name)}(e)?function(e,t,r,s){if(o(e,t),e.nodes){const o=t.clone().removeAll().append(e.nodes);e.append(o),n(t),s(o,r)}}(e,c,t,u):i(e)&&i(c)&&function(e,t){return s.includes(e.name)&&e.name===t.name}(e,c)&&l(e,c),"nodes"in e&&e.nodes.length&&u(e,t)}))}const p=()=>({postcssPlugin:"postcss-nesting",Rule(e,{result:n}){u(e,n),e.selector.trim().includes("&")&&function(e){let n=e.parent;for(;n;){if("rule"===n.type)return;n=n.parent}const o=t.default().astSync(e.selector);o&&(o.walkNesting((e=>{e.replaceWith(t.default.pseudo({value:":scope"}))})),e.selector=o.toString())}(e)}});p.postcss=!0,module.exports=p;
